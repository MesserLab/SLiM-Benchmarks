/*
	T_CalculateAllDistances3D.slim
	
	This exercises building the distance sparse array.  This is the 3D case.
*/

initialize() {
	initializeSLiMOptions(dimensionality="xyz");
	initializeMutationRate(0);
	initializeMutationType("m1", 0.5, "f", 0.0);
	initializeGenomicElementType("g1", m1, 1.0);
	initializeGenomicElement(g1, 0, 99999);
	initializeRecombinationRate(0);
	
	initializeInteractionType(1, "xyz", reciprocal=T, maxDistance=0.05);
	i1.setInteractionFunction("f", 1.0);
}
1 late() {
	sim.addSubpop("p1", 1000000);
	
	inds = p1.individuals;
	inds.setSpatialPosition(p1.pointUniform(p1.individualCount));
	
	i1.evaluate(immediate=F);
	
	// this calls CalculateAllDistances() without evaluating strengths
	i1.interactingNeighborCount(inds[0]);
}
