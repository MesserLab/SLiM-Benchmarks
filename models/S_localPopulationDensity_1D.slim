/*
	S_localPopulationDensity_1D.slim
	
	This exercises querying with localPopulationDensity(), in 1D.
	The maxDistance is set to produce about 27 million interactions, and
	then the number of replicates is scaled to take about ten seconds.
*/

initialize() {
	initializeSLiMOptions(dimensionality="x");
	initializeInteractionType(1, "x", reciprocal=T, maxDistance=0.15);
	i1.setInteractionFunction("n", 1.0, 0.15);
}
1 late() {
	sim.addSubpop("p1", 10000);
	
	inds = p1.individuals;
	inds.setSpatialPosition(p1.pointUniform(p1.individualCount));
	
	i1.evaluate(p1);
	x = sapply(1:45, "sumExact(i1.localPopulationDensity(inds));");
	
	// summarize results
	first_x = x[0];
	all_equal = all(x == first_x);
	if (all_equal)
		catn("### ALL " + first_x + " (" + length(x) + ") ###");
	else
		catn("### *** INCONSISTENT *** " + mean(x) + " (" + length(x) + ") *** ###");
}
