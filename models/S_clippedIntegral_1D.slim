/*
	S_clippedIntegral_1D.slim
	
	This exercises querying with clippedIntegral() in the 1D case.
*/

initialize() {
	initializeSLiMOptions(dimensionality="x");
	initializeInteractionType(1, "x", reciprocal=T, maxDistance=0.15);
	i1.setInteractionFunction("n", 1.0, 0.05);
}
1 late() {
	sim.addSubpop("p1", 1000000);
	
	inds = p1.individuals;
	inds.setSpatialPosition(p1.pointUniform(p1.individualCount));
	
	i1.evaluate(p1);
	start = clock();
	x = sapply(1:400, "sumExact(i1.clippedIntegral(inds));");
	catn("time for parallelizable fraction: " + (clock() - start));
	
	// summarize results
	first_x = x[0];
	all_equal = all(x == first_x);
	if (all_equal)
		catn("### ALL " + first_x + " (" + length(x) + ") ###");
	else
		catn("### *** INCONSISTENT *** " + mean(x) + " (" + length(x) + ") *** ###");
}
